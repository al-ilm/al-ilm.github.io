---
layout: post
title:  "CIFAR-100: Neural Network in Python and R using Keras"
date:   2018-3-9 1:00:00 +0800
categories: Machine Learning Statistics Programming R Python Keras
comments: true
---
The foundations of the deep learning models we have today, most of it, extends from the basic architecture of the artificial neural networks (ANNs).
The latest in the advancement of artificial intelligence (AI), is the use of two competing neural networks 
(i.e. Generative Adversarial Network (GAN)). Hence, anyone who attempts to dive into the field of AI must atleast possessed: 
the understanding of the theory and practical use of ANN.
<p>
    In this article, I want to talk about the application of neural networks on classification problem. In particular, we'll not talk about the theory,
    instead we'll try to explore the Keras Python package using the CIFAR-100 dataset. My objective here is to illustrate how to use the said package
    on both Python and R programming languages.
</p>
    <div class="section1-label-wrapper">
        <span class="section1-label">Package Installation</span>
    </div>
    To setup the required libraries for this article, run the following code in the terminal/cmd:
    <img class="figures" style="display: block; margin: -5px 0;" src="/assets/images/nn-in-julia-using-fluxjl/img3.png">
    This will install the python packages namely <a href="http://www.numpy.org/" target="_blank">Numpy</a>, <a href="https://www.tensorflow.org/" target="_blank">Tensorflow</a> and <a href="https://keras.io/" target="_blank">Keras</a>. 
    Now to install <a href="https://keras.rstudio.com/" target="_blank">Keras in R</a>, run the following:
    <script src="https://gist.github.com/alstat/dfc3e086279c37263cd47621bad657d2.js"></script>
</p>
<p>
    Note: You must install the Python packages before running the above R code, this will install the requirements needed in R Keras. Otherwise,
    you need to run <code>install_keras()</code> after the above R code (more details <a href="https://keras.rstudio.com/reference/install_keras.html" target="_blank">here</a>).
</p>
<p>
    Now that the tools are properly installed in our machine, next is to load the packages in Python and the necessary functions to use:
    <script src="https://gist.github.com/alstat/e8f2ac3b8374c6fd00300a1d0de213b3.js"></script>
    and in R,
    <script src="https://gist.github.com/alstat/780da185409f14f9d277d3919dda6581.js"></script>
    The constants above are used for later computation, specifically <code>CONST_N</code> is the number of training/testing data to be used.
    This is because CIFAR-100 has 50000 training examples and 10000 testing examples. If you don't have GPU, the training phase of the modeling will take time to finish. Hence,
    as mentioned earlier, this blog post is meant to get us started with the Neural Network using CIFAR-100 dataset, and that is by discussing the steps with no assumption of using GPU. It's up to the reader to adjust the number of the datasets
    to be used, or maybe do some randomization in choosing the sample examples. For purpose of simplicity and illustration, we set the first 2000 samples to be used in training our model.
    <div class="section2-label-wrapper">
        <span class="section2-label">Download Data</span>
    </div>
    The official CIFAR-100 dataset is available for download at the <a href="https://www.cs.toronto.edu/~kriz/cifar.html" target="_blank">Alex Krizhevskey's website</a>.
    There are three different versions that you can download, either Python, Matlab or Binary version. Since R Keras was built on top of Python, our option is to download the Python version.
    To download the CIFAR-100 dataset in Python, and assign this to the appropriate variable run the following:
    <script src="https://gist.github.com/alstat/fdc1eb5b5100be9527153411993693a5.js"></script>
    and in R,
    <script src="https://gist.github.com/alstat/9c824ec7809e98f078ad74c8016c70d5.js"></script>
    In case you wonder, the above lines will save the dataset so that the next time you run it, it will just load the file instead of downloading it again.
</p>
<p>
    There are two training labels for CIFAR-100 if you notice above, the <i>coarse</i> (the super class, e.g. fish) and the <i>fine</i> (the class, e.g. aquarium fish, flatfish, ray, etc.).
    For our case, we'll stick with the fine class. 
    <div class="section3-label-wrapper">
        <span class="section3-label">Preliminary Investigation</span>
    </div>
    It's a good practice to start with the preliminary investigation of the dataset before proceeding to modeling. Let's check the dimension and type of our dataset.
    <script src="https://gist.github.com/alstat/3659ace479413d76c2c86fa76073f42a.js"></script>
    and in R,
    <script src="https://gist.github.com/alstat/dd05a85300c861322ff777715053e466.js"></script>
    Hence the input image we have is a 32 by 32 in resolution with 3 channels (for red, green, and blue), and there are 50,000 of these. In order
    to view the first array of our <code>x_train</code>, run <code>x_train[0]</code> in Python and <code>x_train[1,,,]</code> in R. Since we are dealing with images, it's required (at least for me) to view the image,
    this will give us better understanding of how these arrays of pixels translate into an image.
    <script src="https://gist.github.com/alstat/62edb9825da51e19ba1637ee5875a6d1.js"></script>
    <div class="figure-wrapper">
        <img class="figures" src="/assets/images/nn-in-pyr-using-keras/img1.png">
        <div class="figure-caption">
            <span class="website-label">
                العلم
            </span>
            <span class="caption">
                Fig 1: Another approach of visualizing the empirical distribution of the sampled datasets.
            </span>
        </div>
    </div> 
    Unfortunately, I tried my best but I can't removed those whitespaces using matplotlib. I would love to update the above figure
    if someone can do it for me. In R, there is also a way to plot images using the EBImage package. I made a blog post about it three years ago, check it
    <a href="https://alstatr.blogspot.com/2014/09/r-image-analysis-using-ebimage.html" target="_blank">here</a>.
    <div class="section4-label-wrapper">
        <span class="section4-label">Data Preparation</span>
    </div>
    <script src="https://gist.github.com/alstat/e13cb240ac9be2d9822fb83e4836f53a.js"></script>
    <div class="section5-label-wrapper">
        <span class="section5-label">Modeling and Prediction</span>
    </div>
    <script src="https://gist.github.com/alstat/edf68b86f174e2d67c8a5a11ef6af27a.js"></script>
</p>



Accurate inference of our population from our sample is the main interest of Statistics and Machine Learning.
The goal is to have a random sample that well represents the population, that is, our inference is subject to some tolerable errors. 
Errors in exchange of surveying small number of respondence over censusing the whole population. Having said, 
it is therefore important to understand the concept behind survey sampling to properly interpret the statistical methodologies 
we used (e.g. hypothesis testing), which needless to say, are heavily tied up into these basic concepts. One such concept that we are going to 
tackle in this article is the <b>sampling distribution</b>. Sampling distribution is one of the basis of why survey works.
<script src="https://gist.github.com/alstat/4b2c2e53949c6eab9d46a0a5cd33d3ed.js"></script>
<p>
    <div class="scenario-label-wrapper">
        <span class="scenario-label">Scenario</span>
    </div>
    Consider the case where we want to estimate the average height of the students in a university. Suppose out of 1500 
    students in the university, we surveyed 100 students only. Suppose further, the sample mean we obtain is 5.456 inches. This is the average 
    height of the students in our random sample. The question is, how do we relate the sampling distribution to our estimate?
    Well the relationship is evident once we do resampling as stated below.
    <div class="quote with-bottom-border">
        In theory, if we were to do resampling from our population infinitely and we take the sample estimate of each resample, 
        the overall mean of these sample estimates will converge to the true parameter.
    </div>
    The distribution of the sample estimates in this case is referred to as the <i>sampling</i> distribution. 
    Therefore, if we extend the scenario and proceed with the resampling from our population, say 15 resamples each of
    size 100 (i.e. 100 samples for each resample), we expect the sample mean of our sampling distribution to converge to the true parameter
    up to some significant values. The following figure is the histogram with empirical density estimate of the possible data we might get.
    <div class="figure-wrapper">
        <img class="figures" src="/assets/images/random_samples.svg"/>
        <div class="figure-caption">
            <span class="website-label">
                العلم
            </span>
            <span class="caption">
                Fig 1: The possible resamples from the population of the height of the students in the university.
            </span>
        </div>
    </div> 
    From the above figure, we can subjectively conclude that the mean of the samples is around 5.5. Indeed, because that's 
    the true parameter we assigned in simulating these datasets. The sample mean of the above resamples are given below:
    <div class="quote" style="text-align:center;">
            5.456, 5.490, 5.511, 5.472, 5.467, 5.531, 5.519, <br> 5.481, 5.507, 5.511, 5.525, 5.521, 5.524, 5.474, 5.486
    </div>

    Using the sampling distribution of these estimates we found out the mean (overall mean) to be 5.498 which is equivalent to 5.5 
    under 0.002 error. Now let's consider the sampling distribution of the sample variance of the above dataset. This time let's
    increase the number of resample to 10,000 and see the corresponding sampling distribution.
    
    <div class="figure-wrapper">
        <img class="figures" src="/assets/images/density_boxplot.svg"/>
        <div class="figure-caption">
            <span class="website-label">
                العلم
            </span>
            <span class="caption">
                Fig 2: Another approach of visualizing the empirical distribution of the sampled datasets.
            </span>
        </div>
    </div> 
    <script src="https://gist.github.com/alstat/b12ac7e6f2837e41fd7f20546607da6b.js"></script>
</p>